# **微算機專題-太鼓機器貓**

**組員:** 王逸蓁、許晏綾、黃薇庭、葉治嘉

## **系統功能與原理說明**

本作品主要使用了兩個外部元件：PCA9685及電容式觸摸感測模組來實現太鼓機器貓的功能。PCA9685是為了方便控制多顆馬達的轉動，並利用此特性來控制鼓棒的揮動幅度；而觸摸感測模組則是用於控制鼓棒是否要敲擊，程式中的ADC interrupt會反覆偵測，當使用者觸碰到觸摸感測模組時，會將鼓棒往下揮，而離開時則會將鼓棒抬起。

## **系統使用環境及對象**

1.系統使用環境：MPLAB X IDE v5.20

2.語言：c 語言

3.編譯器：XC8

4.燒錄器具：pickit4

5.晶片：pic18f4520

**適用對象：** 此太鼓機器貓非常適合家庭同樂，沒有特定的使用情境及年齡限制，不過不方便攜帶，因此建議在室內遊玩。

## **系統設計**

太鼓機器貓主要分為兩種模式（mode），並使用按鈕進行切換

mode1：由使用者按壓兩個觸摸感測模組來分別控制貓咪兩隻手敲擊鼓面，可以自行設計節奏遊玩

mode2：由貓咪自動演奏事先寫好的節奏（小星星）並循環，若演奏到一半按下按鈕會馬上切換至mode1

手部控制：由PCA9685控制兩手的馬達的角度旋轉做出敲擊的效果

## **系統開發工具、材料及技術**

| 材料 | 技術 | 功能 |
| :---: | :---: | :---: |
| PP瓦楞板、毛球、冰棒棍 | 美工刀、熱熔膠  | 貓咪頭部、身體及腳掌 |
| PCA9685 | PWM  | 控制多個PWM輸出 |
| SG90伺服馬達 | PWM | 控制四肢轉動幅度 |
| 電容式觸摸感測模組 | ADC、interrupt  |  打擊控制 |
| 燈泡與按鈕 | interrupt | 切換模式 |

## **周邊接口或 Library 及 API 使用說明**

**單元項目**

PWM：伺服馬達

Interrupt：電容式觸摸感測模組、按鈕

ADC：電容式觸摸感測模組

**進階單元項目**

**PCA9685**

PCA本身有提供一個25M的震盪器專供控制馬達使用，因此只需要將所需馬達頻率（20ms）對應的prescaler算好並利用I2C溝通後寫入PCA即可完成初始化。

初始化完成後一樣會使用I2C溝通PCA，先告知要使哪個馬達轉動（總共16個接孔），再告知高電位、低電位時間，即可使馬達正確轉動。

**電容式觸摸感測模組**

常態下，模組輸入低電平（Low, 0），當用手指觸摸相應位置後，將訊號經過ADC轉換成0\~1023的數值，超過特定數字（在這次專案中數字為800）的即被判定為觸摸

## **實際組員之分工項目**

| 組員 | 學號 | 分工 |
| :---: | :---: | :---: |
| 王逸蓁 | AN4116097 | 機構設計 |
| 許晏綾 | AN4116047 | 機構設計、mode與節奏程式 |
| 黃薇庭 | F64101032 | 觸摸感測模組 |
| 葉治嘉 | AN4111071 | 馬達控制、程式整合 |

 

## **遇到的困難及如何解決**

1\. 馬達無法帶動腿部轉動（原題目機器貓的問題）

木棍的兩側都開洞之後，我們將馬達凸起處和洞口連接，實際操作後發現馬達和木棍(大腿、小腿)的接口處不夠牢固，馬達轉動時無法帶動腿的轉動。

解決方法：為了增加附著力，先使用細線將馬達上方的扇葉和木棍纏起來，再用黏著劑固定，我們選擇了熱熔膠(膠帶、白膠黏著力太小)，如此一來就實現了腿部轉動。

2\. 腳部承重問題（原題目機器貓的問題）

身體底座和腿部連接部分採用PP瓦楞板設計卡榫，搭配熱熔膠固定，確保身體的結構足夠堅固。但後來發現，雖然貓咪靜止時可以支撐，但因為麵包板的重量太重，正向力導致摩擦力太大，而伺服馬達的力量不夠使貓咪行走，最多只能原地踏步。

解決方法：換成讓貓咪坐著，用其手部來做其他功能。

3\. 電池供電問題

使用超過兩顆馬達時只接一個6V的電池盒不夠，會導致馬達初始扭力不夠，無法轉動。

解決方法：使用了三個6V的電池盒並聯提供足夠的電流，使馬達正確運行。

4\. 麵包板燒壞

因過程中反覆試驗導致有杜邦線被燒壞，使得麵包板的接孔也跟著損壞，直到demo當天早上才發現程式無法燒錄，並在測試之後確認為麵包板的問題。

解決方法：重新換一塊板子

5.觸摸模組切換問題

有兩片模組同時需要A/D轉換。

解決方法：在每次進入interrupt時輪流切換AN0/AN1 channel

影片檔觀看連結：[https://drive.google.com/file/d/1QT4EKrLsPDjPWiolBud4ILnfGuU2en4U/view?usp=drivesdk](https://drive.google.com/file/d/1QT4EKrLsPDjPWiolBud4ILnfGuU2en4U/view?usp=drivesdk)  
